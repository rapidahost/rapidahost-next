// Lightweight logger that works without extra deps
type Meta = Record<string, unknown> | undefined

export const logger = {
  info: (msg: string, meta?: Meta) => console.log('[INFO]', msg, meta ?? ''),
  warn: (msg: string, meta?: Meta) => console.warn('[WARN]', msg, meta ?? ''),
  error: (msg: string, meta?: Meta) => console.error('[ERROR]', msg, meta ?? ''),
}

// Optional: enable Logtail only if token exists and package installed
export async function logtail(msg: string, meta?: Meta, level: 'info'|'warn'|'error'='info') {
  try {
    if (!process.env.LOGTAIL_SOURCE_TOKEN) return
    const { Logtail } = await import('@logtail/node') // soft import
    const client = new Logtail(process.env.LOGTAIL_SOURCE_TOKEN)
    await (client as any)[level](msg, meta)
  } catch {
    // ignore if package not installed
  }
}
