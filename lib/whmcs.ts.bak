// lib/whmcs.ts
import axios from 'axios'

const WHMCS_API_URL = process.env.WHMCS_API_URL!
const IDENTIFIER = process.env.WHMCS_IDENTIFIER!
const SECRET = process.env.WHMCS_SECRET!

async function callWHMCS(action: string, params: any) {
  const response = await axios.post(WHMCS_API_URL, {
    identifier: IDENTIFIER,
    secret: SECRET,
    action,
    ...params,
    responsetype: 'json',
  })

  return response.data
}

export async function getClient(clientId: number) {
  const res = await callWHMCS('GetClientsDetails', { clientid: clientId, stats: false })
  return res.result === 'success' ? res : null
}

export async function getInvoice(invoiceId: number) {
  const res = await callWHMCS('GetInvoice', { invoiceid: invoiceId })
  return res.result === 'success' ? res : null
}

export async function getService(serviceId: number) {
  const res = await callWHMCS('GetClientsProducts', { serviceid: serviceId })
  return res.result === 'success' && res.products?.product?.[0] ? res.products.product[0] : null
}
